import UIKit


class SeekerProfileViewController: UIViewController {

    // MARK: - IBOutlets
    // ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ø¨Ø· Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ù€ Storyboard
    @IBOutlet weak var profileImageView: UIImageView!
    @IBOutlet weak var nameLabel: UILabel!
    
    @IBOutlet weak var usernameLabel: UILabel!
    @IBOutlet weak var locationLabel: UILabel! // Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹
    
    // 2. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù€ ViewModel
        var viewModel = SeekerProfileViewModel()

        override func viewDidLoad() {
            super.viewDidLoad()
            setupBindings() // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
            viewModel.fetchUserProfile() // Ø·Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ Ù…Ø§ ØªÙØªØ­ Ø§Ù„ØµÙØ­Ø©
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª
            locationLabel.text = "Bahrain ğŸ‡§ğŸ‡­"
        }

        // 3. Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø· (Binding) - ØªØ±Ø§Ù‚Ø¨ Ø§Ù„Ù€ ViewModel
        func setupBindings() {
            
            // Ù„Ù…Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙˆØµÙ„ Ø¨Ù†Ø¬Ø§Ø­
            viewModel.onUserDataUpdated = { [weak self] user in
                DispatchQueue.main.async {
                    self?.nameLabel.text = user.name
                    self?.usernameLabel.text = "@\(user.username ?? "user")" // Ù„Ùˆ Ù…Ø§ÙÙŠ ÙŠÙˆØ²Ø±Ù†ÙŠÙ…
                    
                    // Ù„Ù„ØµÙˆØ±Ø©ØŒ Ø¨Ù†Ø³ØªØ®Ø¯Ù… Ù…ÙƒØªØ¨Ø© Ø£Ùˆ ÙƒÙˆØ¯ ØªØ­Ù…ÙŠÙ„ Ø¨Ø³ÙŠØ· (SDWebImage Ø£ÙØ¶Ù„ Ø´ÙŠØ¡ Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ)
                    // Ø­Ø§Ù„ÙŠØ§Ù‹ Ù…Ø«Ø§Ù„ Ø¨Ø³ÙŠØ·:
                    if let imageURL = user.profileImageURL, let url = URL(string: imageURL) {
                        // Ù‡Ù†Ø§ Ø§Ù„Ù…ÙØ±ÙˆØ¶ ØªØ³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø©ØŒ Ø³Ø£Ø¶Ø¹ ÙƒÙˆØ¯ Ø¨Ø³ÙŠØ· Ù„Ù„ØªÙˆØ¶ÙŠØ­
                        DispatchQueue.global().async {
                            if let data = try? Data(contentsOf: url) {
                                DispatchQueue.main.async {
                                    self?.profileImageView.image = UIImage(data: data)
                                }
                            }
                        }
                    }
                }
            }
            
            viewModel.onError = { errorMessage in
                print("Error fetching profile: \(errorMessage)")
            }
        }
    }
   
